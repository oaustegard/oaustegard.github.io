<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Skills - Releases</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Import Map Configuration -->
  <script type="importmap">
    {
      "imports": {
        "preact": "https://esm.sh/*preact@10.23.1",
        "preact/": "https://esm.sh/*preact@10.23.1/",
        "@preact/signals": "https://esm.sh/*@preact/signals@1.3.0",
        "@preact/signals-core": "https://esm.sh/*@preact/signals-core@1.8.0",
        "htm": "https://esm.sh/*htm@3.1.1",
        "htm/preact": "https://esm.sh/*htm@3.1.1/preact"
      }
    }
  </script>

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { render } from 'preact';
    import { useSignal, useComputed } from '@preact/signals';
    import { useEffect } from 'preact/hooks';
    import { html } from 'htm/preact';

    function App() {
      const releases = useSignal([]);
      const loading = useSignal(true);
      const error = useSignal(null);

      // Fetch releases from GitHub API
      useEffect(() => {
        async function fetchReleases() {
          try {
            const response = await fetch('https://api.github.com/repos/oaustegard/claude-skill/releases');

            if (!response.ok) {
              throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            releases.value = data;
            loading.value = false;
          } catch (err) {
            error.value = err.message;
            loading.value = false;
          }
        }

        fetchReleases();
      }, []);

      // Sort releases alphabetically by tag name
      const sortedReleases = useComputed(() => {
        return [...releases.value].sort((a, b) => {
          const nameA = (a.tag_name || a.name || '').toLowerCase();
          const nameB = (b.tag_name || b.name || '').toLowerCase();
          return nameA.localeCompare(nameB);
        });
      });

      // Loading state
      if (loading.value) {
        return html`
          <div class="min-h-screen bg-gray-100 flex items-center justify-center">
            <div class="bg-white p-8 rounded-lg shadow-lg">
              <div class="text-center">
                <div class="animate-spin inline-block w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mb-4"></div>
                <p class="text-gray-600">Loading releases...</p>
              </div>
            </div>
          </div>
        `;
      }

      // Error state
      if (error.value) {
        return html`
          <div class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
            <div class="bg-white p-8 rounded-lg shadow-lg max-w-md">
              <div class="text-center">
                <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Error Loading Releases</h2>
                <p class="text-gray-600">${error.value}</p>
              </div>
            </div>
          </div>
        `;
      }

      return html`
        <div class="min-h-screen bg-gray-100 py-8 px-4">
          <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">Claude Skills - Releases</h1>
              <p class="text-gray-600">
                Alphabetical listing of all releases from
                <a href="https://github.com/oaustegard/claude-skill"
                   class="text-blue-500 hover:underline"
                   target="_blank"
                   rel="noopener noreferrer">
                  oaustegard/claude-skill
                </a>
              </p>
              <p class="text-sm text-gray-500 mt-2">
                Total releases: ${sortedReleases.value.length}
              </p>
            </div>

            <div class="space-y-4">
              ${sortedReleases.value.map(release => {
                // Find .zip assets
                const zipAssets = (release.assets || []).filter(asset =>
                  asset.name.toLowerCase().endsWith('.zip')
                );

                return html`
                  <${ReleaseCard}
                    key=${release.id}
                    name=${release.name || release.tag_name}
                    version=${release.tag_name}
                    description=${release.body}
                    zipAssets=${zipAssets}
                  />
                `;
              })}
            </div>

            ${sortedReleases.value.length === 0 && html`
              <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                <p class="text-gray-600">No releases found.</p>
              </div>
            `}
          </div>
        </div>
      `;
    }

    function ReleaseCard({ name, version, description, zipAssets }) {
      return html`
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6">
          <div class="flex items-start justify-between mb-3">
            <div>
              <h2 class="text-xl font-bold text-gray-800">${name}</h2>
              <p class="text-sm text-gray-500 font-mono">${version}</p>
            </div>
          </div>

          ${description && html`
            <div class="prose prose-sm max-w-none mb-4 text-gray-700 whitespace-pre-wrap">
              ${description}
            </div>
          `}

          ${zipAssets.length > 0 && html`
            <div class="border-t pt-4">
              <p class="text-sm font-semibold text-gray-700 mb-2">Downloads:</p>
              <div class="flex flex-wrap gap-2">
                ${zipAssets.map(asset => html`
                  <a
                    key=${asset.id}
                    href=${asset.browser_download_url}
                    class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm font-medium"
                    download
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    ${asset.name}
                  </a>
                `)}
              </div>
            </div>
          `}

          ${zipAssets.length === 0 && html`
            <p class="text-sm text-gray-500 italic border-t pt-4">No .zip files available for this release</p>
          `}
        </div>
      `;
    }

    render(html`<${App} />`, document.getElementById('app'));
  </script>
</body>
</html>
