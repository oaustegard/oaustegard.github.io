<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bicycle Tire Air Volume Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
        "imports": {
            "preact": "https://esm.sh/preact@10.23.1",
            "preact/": "https://esm.sh/preact@10.23.1/",
            "@preact/signals": "https://esm.sh/@preact/signals@1.3.0?external=preact",
            "htm/preact": "https://esm.sh/htm@3.1.1/preact?external=preact"
        }
    }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app"></div>
    
    <script type="module">
        import { render } from 'preact';
        import { signal, computed } from '@preact/signals';
        import { html } from 'htm/preact';

        // Tire geometry constants
        const TIRE_TYPES = {
            road: { thickness: 2.5, label: 'Road' },
            gravel: { thickness: 3.5, label: 'Gravel' },
            mtb: { thickness: 5, label: 'Mountain' }
        };

        const WHEEL_SIZES = {
            '700c': { bsd: 622, label: '700c' },
            '650b': { bsd: 584, label: '650b' }
        };

        // State signals
        const wheelSize = signal('700c');
        const tireWidth = signal(28);
        const rimWidth = signal(19);
        const tireType = signal('road');
        const pressure = signal(80);
        const pressureUnit = signal('psi');
        const pumpVolume = signal(150); // ml per stroke

        // Calculate tire geometry
        const tireGeometry = computed(() => {
            const bsd = WHEEL_SIZES[wheelSize.value].bsd;
            const width = tireWidth.value;
            const rimWidthMm = rimWidth.value;
            const thickness = TIRE_TYPES[tireType.value].thickness;
            
            // Tire height approximation based on width and rim width
            // Wider rims make tires shorter and wider
            const rimRatio = rimWidthMm / width;
            const heightFactor = Math.max(0.4, 0.6 - (rimRatio - 0.4) * 0.3);
            const tireHeight = width * heightFactor;
            
            const outerRadius = (bsd / 2) + tireHeight;
            const innerRadius = outerRadius - thickness;
            const circumference = Math.PI * bsd;
            
            return {
                outerRadius,
                innerRadius,
                circumference,
                tireHeight
            };
        });

        // Calculate air volume
        const airVolume = computed(() => {
            const geom = tireGeometry.value;
            const crossSectionArea = Math.PI * (geom.outerRadius ** 2 - geom.innerRadius ** 2);
            const volumeCm3 = (crossSectionArea * geom.circumference) / 1000; // Convert mmÂ³ to cmÂ³
            return volumeCm3;
        });

        // Calculate pressure in different units
        const pressureInBar = computed(() => {
            return pressureUnit.value === 'psi' 
                ? pressure.value / 14.504
                : pressure.value;
        });

        // Calculate pump strokes needed
        const pumpStrokes = computed(() => {
            const volumeMl = airVolume.value;
            const pressureBar = pressureInBar.value;
            const totalAirVolume = volumeMl * pressureBar; // At atmospheric pressure
            return Math.ceil(totalAirVolume / pumpVolume.value);
        });

        function Calculator() {
            return html`
                <div class="max-w-4xl mx-auto p-6">
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                            ðŸš´ Bicycle Tire Air Volume Calculator
                        </h1>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Input Controls -->
                            <div class="space-y-6">
                                <h2 class="text-xl font-semibold text-gray-700 mb-4">Tire Specifications</h2>
                                
                                <!-- Wheel Size -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Wheel Size
                                    </label>
                                    <select 
                                        class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        value=${wheelSize.value}
                                        onChange=${e => wheelSize.value = e.target.value}
                                    >
                                        ${Object.entries(WHEEL_SIZES).map(([key, size]) => html`
                                            <option value=${key}>${size.label} (${size.bsd}mm BSD)</option>
                                        `)}
                                    </select>
                                </div>

                                <!-- Tire Type -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Tire Type
                                    </label>
                                    <select 
                                        class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        value=${tireType.value}
                                        onChange=${e => tireType.value = e.target.value}
                                    >
                                        ${Object.entries(TIRE_TYPES).map(([key, type]) => html`
                                            <option value=${key}>${type.label}</option>
                                        `)}
                                    </select>
                                </div>

                                <!-- Tire Width -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Tire Width: ${tireWidth.value}mm
                                    </label>
                                    <input 
                                        type="range" 
                                        min="23" 
                                        max="50" 
                                        value=${tireWidth.value}
                                        onInput=${e => tireWidth.value = parseInt(e.target.value)}
                                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    />
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>23mm</span>
                                        <span>50mm</span>
                                    </div>
                                </div>

                                <!-- Rim Width -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Rim Width (internal): ${rimWidth.value}mm
                                    </label>
                                    <input 
                                        type="range" 
                                        min="13" 
                                        max="30" 
                                        value=${rimWidth.value}
                                        onInput=${e => rimWidth.value = parseInt(e.target.value)}
                                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    />
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>13mm</span>
                                        <span>30mm</span>
                                    </div>
                                </div>

                                <!-- Pressure -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Pressure: ${pressure.value} ${pressureUnit.value.toUpperCase()}
                                    </label>
                                    <div class="flex gap-2 mb-2">
                                        <button 
                                            class=${`px-3 py-1 text-sm rounded ${pressureUnit.value === 'psi' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                            onClick=${() => pressureUnit.value = 'psi'}
                                        >
                                            PSI
                                        </button>
                                        <button 
                                            class=${`px-3 py-1 text-sm rounded ${pressureUnit.value === 'bar' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                            onClick=${() => pressureUnit.value = 'bar'}
                                        >
                                            BAR
                                        </button>
                                    </div>
                                    <input 
                                        type="range" 
                                        min=${pressureUnit.value === 'psi' ? '20' : '1.4'}
                                        max=${pressureUnit.value === 'psi' ? '120' : '8.3'}
                                        step=${pressureUnit.value === 'psi' ? '5' : '0.1'}
                                        value=${pressure.value}
                                        onInput=${e => pressure.value = parseFloat(e.target.value)}
                                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    />
                                </div>

                                <!-- Pump Volume -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Pump Volume per Stroke: ${pumpVolume.value}ml
                                    </label>
                                    <input 
                                        type="range" 
                                        min="50" 
                                        max="300" 
                                        step="10"
                                        value=${pumpVolume.value}
                                        onInput=${e => pumpVolume.value = parseInt(e.target.value)}
                                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    />
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>Mini pump (50ml)</span>
                                        <span>Track pump (300ml)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Results -->
                            <div class="space-y-6">
                                <h2 class="text-xl font-semibold text-gray-700 mb-4">Calculations</h2>
                                
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <h3 class="text-lg font-semibold text-blue-800 mb-4">Tire Air Volume</h3>
                                    <div class="text-3xl font-bold text-blue-600 mb-2">
                                        ${airVolume.value.toFixed(1)} ml
                                    </div>
                                    <div class="text-sm text-blue-700">
                                        At ${pressureInBar.value.toFixed(1)} bar (${(pressureInBar.value * 14.504).toFixed(0)} psi)
                                    </div>
                                </div>

                                <div class="bg-green-50 p-6 rounded-lg">
                                    <h3 class="text-lg font-semibold text-green-800 mb-4">Pump Strokes</h3>
                                    <div class="text-3xl font-bold text-green-600 mb-2">
                                        ~${pumpStrokes.value} strokes
                                    </div>
                                    <div class="text-sm text-green-700">
                                        To inflate from 0 to target pressure
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-6 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Tire Geometry</h3>
                                    <div class="space-y-2 text-sm">
                                        <div>Outer radius: ${tireGeometry.value.outerRadius.toFixed(1)}mm</div>
                                        <div>Inner radius: ${tireGeometry.value.innerRadius.toFixed(1)}mm</div>
                                        <div>Tire height: ${tireGeometry.value.tireHeight.toFixed(1)}mm</div>
                                        <div>Circumference: ${(tireGeometry.value.circumference / 1000).toFixed(2)}m</div>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-yellow-800 mb-2">ðŸ’¡ Notes</h4>
                                    <ul class="text-sm text-yellow-700 space-y-1">
                                        <li>â€¢ Calculations are approximations based on tire geometry</li>
                                        <li>â€¢ Actual volume may vary by manufacturer and tire design</li>
                                        <li>â€¢ Pump efficiency affects actual strokes needed</li>
                                        <li>â€¢ Tubeless sealant volume (~2-5ml) is negligible</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        render(html`<${Calculator} />`, document.getElementById('app'));
    </script>

    <style>
        .slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }
    </style>
</body>
</html>
